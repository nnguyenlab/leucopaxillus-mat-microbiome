setwd("/Volumes/GoogleDrive/Shared drives/Research/active_projects/mat_bacteria/Leucopaxillus_mat/analyses/R analyses/ITS")
library(tidyverse)
library(vegan)
library(phyloseq)
library(patchwork)
#library(agricolae)
library(pairwiseAdonis)
#library(qiime2R)
library(RColorBrewer)
#display.brewer.all()
##===================================================================================================
##                                  Read in and wrangle data
##===================================================================================================
#Read in rarefied OTU table
otu_table <- read.table(file="rarefied-table-with-taxonomy.tsv", header=TRUE, sep='\t', check.names=FALSE, row.names=1) %>%
select(-taxonomy) %>%
t() %>%
as_tibble()
# #Read in taxonomy
# taxa_table <- read.table(file="taxonomy.tsv", header=TRUE, sep='\t', check.names=FALSE) %>%
#   rename(Feature.ID="Feature ID") %>%
#   parse_taxonomy() %>%
#   as.matrix()
#Read in diversity metrics
Observed_otus <- read.table(file="observed-otus.tsv", header=TRUE)
Shannon_div <- read.table(file="shannon-diversity.tsv", header=TRUE)
#Faith_PD <- read.table(file="faith-PD.tsv", header=TRUE)
#Read in metadata file and merge Obseverd OTUs and Shannon Diversity with the metadata
metadata_table <- read.table(file="metadata-leucopax.txt", header=TRUE) %>%
left_join(Observed_otus, by="SampleID", row.names="SampleID") %>%
left_join(Shannon_div, by="SampleID") %>%
#left_join(Faith_PD, by="SampleID") %>%
drop_na() %>%
as_tibble()
#Format data tables for phyloseq
otu <- otu_table(otu_table, taxa_are_rows=FALSE)
# taxa <- tax_table(taxa_table)
metadata <- sample_data(metadata_table)
# tree<-read_tree("Leucopaxillus-bact-tree.nwk")
#Checking for consistent OTU names
#taxa_names(taxa)
#taxa_names(otu)
#Merge data tables into a phyloseq object
merged_tables <- phyloseq(otu, metadata)#, tree, taxa)
observed_asv_plot_fungi <- ggplot(metadata, aes(x=HostSampleType, y=observed_features, fill=HostSampleType)) +
#stat_boxplot(geom = "errorbar", width = 0.1) +
geom_boxplot(outlier.color="gray", show.legend = FALSE) +
theme_classic() +
scale_fill_manual(values=c("#B3DE68", "#8DD3C7", "#FDB462", "#FB8072"), name="Sample type",
labels=c("L. albissimus mat", "L. albissimus non-mat", "L. gentianeus mat", "L. gentianeus non-mat")) +
#scale_fill_brewer(palette="Dark2") +
scale_x_discrete(limit=c("L.gentianeus_mat", "L.gentianeus_soil", "L.albissimus_mat", "L.albissimus_soil"),
labels = c("L. gentianeus \n mat", "L. gentianeus \n non-mat", "L. albissimus \n mat", "L. albissimus \n non-mat")) +
labs(x="", y = "Observed ASVs", tag="A") +
theme(axis.text.x = element_text(face = "italic")) +
theme(plot.tag = element_text(size=18))
faiths_pd_plot_fungi <- ggplot(metadata, aes(x=HostSampleType, y=shannon_entropy, fill=HostSampleType)) +
geom_boxplot(outlier.color="gray") +
theme_classic() +
scale_fill_manual(values=c("#B3DE68", "#8DD3C7", "#FDB462", "#FB8072"), name="Sample type",
labels=c("L. albissimus mat", "L. albissimus non-mat", "L. gentianeus mat", "L. gentianeus non-mat")) +
#scale_fill_brewer(palette="Dark2") +
scale_x_discrete(limit=c("L.gentianeus_mat", "L.gentianeus_soil", "L.albissimus_mat", "L.albissimus_soil"),
labels = c("L. gentianeus \n mat", "L. gentianeus \n non-mat", "L. albissimus \n mat", "L. albissimus \n non-mat")) +
labs(x="", y = "Shannon's Diveristy", tag="B") +
theme(axis.text.x = element_text(face = "italic")) +
theme(plot.tag = element_text(size=18))
#Plot together
observed_asv_plot_fungi + faiths_pd_plot_fungi
# ANOVA assumptions failed; will use Kruskal-Wallis test
kruskal_asv <- kruskal.test(observed_features ~ HostSampleType, data = metadata_table)#S
kruskal_shannon <- kruskal.test(shannon_entropy ~ HostSampleType, data = metadata_table)#S
kruskal_asv
kruskal_shannon
wilcox_asv <- pairwise.wilcox.test(metadata_table$observed_features, metadata_table$HostSampleType, p.adjust.method="BH", paired=FALSE)
wilcox_shannon <- pairwise.wilcox.test(metadata_table$shannon_entropy, metadata_table$HostSampleType, p.adjust.method="BH", paired=FALSE)
wilcox_asv
wilcox_shannon
setwd("/Volumes/GoogleDrive/Shared drives/Research/active_projects/mat_bacteria/Leucopaxillus_mat/analyses/R analyses/16S")
otu_table <- read.table(file="rarefied-table-with-taxonomy.tsv", header=TRUE, sep='\t', check.names=FALSE, row.names=1) %>%
select(-taxonomy) %>%
t() %>%
as_tibble()
Observed_otus <- read.table(file="observed-otus.tsv", header=TRUE)
Shannon_div <- read.table(file="shannon-diversity.tsv", header=TRUE)
Faith_PD <- read.table(file="faith-PD.tsv", header=TRUE)
#Read in metadata file and merge Obseverd OTUs and Shannon Diversity with the metadata
metadata_table <- read.table(file="metadata-leucopax-bact.tsv", header=TRUE) %>%
left_join(Observed_otus, by="SampleID", row.names="SampleID") %>%
left_join(Shannon_div, by="SampleID") %>%
left_join(Faith_PD, by="SampleID") %>%
drop_na() %>%
as_tibble()
otu <- otu_table(otu_table, taxa_are_rows=FALSE)
# taxa <- tax_table(taxa_table)
metadata <- sample_data(metadata_table)
tree<-read_tree("Leucopaxillus-bact-tree.nwk")
#Checking for consistent OTU names
#taxa_names(taxa)
#taxa_names(otu)
#Merge data tables into a phyloseq object
merged_tables <- phyloseq(otu, metadata, tree)#, taxa)
##===================================================================================================
##                                  Build alpha diversity Plots
##===================================================================================================
observed_asv_plot <- ggplot(metadata, aes(x=HostSampleType, y=observed_features, fill=HostSampleType)) +
#stat_boxplot(geom = "errorbar", width = 0.1) +
geom_boxplot(outlier.color="gray", show.legend = FALSE) +
theme_classic() +
scale_fill_manual(values=c("#B3DE68", "#8DD3C7", "#FDB462", "#FB8072"), name="Sample type",
labels=c("L. albissimus mat", "L. albissimus non-mat", "L. gentianeus mat", "L. gentianeus non-mat")) +
#scale_fill_brewer(palette="Dark2") +
scale_x_discrete(limit=c("L.gentianeus_mat", "L.gentianeus_soil", "L.albissimus_mat", "L.albissimus_soil"),
labels = c("L. gentianeus \n mat", "L. gentianeus \n non-mat", "L. albissimus \n mat", "L. albissimus \n non-mat")) +
labs(x="", y = "Observed ASVs", tag="A") +
theme(axis.text.x = element_text(face = "italic")) +
theme(plot.tag = element_text(size=18))
faiths_pd_plot <- ggplot(metadata, aes(x=HostSampleType, y=faith_pd, fill=HostSampleType)) +
geom_boxplot(outlier.color="gray") +
theme_classic() +
scale_fill_manual(values=c("#B3DE68", "#8DD3C7", "#FDB462", "#FB8072"), name="Sample type",
labels=c("L. albissimus mat", "L. albissimus non-mat", "L. gentianeus mat", "L. gentianeus non-mat")) +
#scale_fill_brewer(palette="Dark2") +
scale_x_discrete(limit=c("L.gentianeus_mat", "L.gentianeus_soil", "L.albissimus_mat", "L.albissimus_soil"),
labels = c("L. gentianeus \n mat", "L. gentianeus \n non-mat", "L. albissimus \n mat", "L. albissimus \n non-mat")) +
labs(x="", y = "Faith's Phylogenetic Diveristy", tag="B") +
theme(axis.text.x = element_text(face = "italic")) +
theme(plot.tag = element_text(size=18))
#Plot together
observed_asv_plot + faiths_pd_plot
# Will use Observed ASV and Faith's PD for manuscript; ANOVA assumptions OK
anova_observed_asv <- aov(metadata$observed_features ~ metadata$HostSampleType)
summary(anova_observed_asv)
tukey_observed_asv <- TukeyHSD(anova_observed_asv, ordered="TRUE")
# Extract letters associated with significance with the "multcompView" package
observed_letters <- multcompLetters4(anova_observed_asv, tukey_observed_asv)
library(multcompView)
observed_letters <- multcompLetters4(anova_observed_asv, tukey_observed_asv)
as.data.frame.list(observed_letters$`metadata$HostSampleType`)
tukey_faiths_pd
tukey_faiths_pd <- TukeyHSD(anova_faiths_pd, ordered="TRUE")
anova_observed_asv <- aov(metadata$observed_features ~ metadata$HostSampleType)
summary(anova_observed_asv)
tukey_observed_asv <- TukeyHSD(anova_observed_asv, ordered="TRUE")
tukey_observed_asv
anova_faiths_pd <- aov(metadata$faith_pd ~ metadata$HostSampleType)
summary(anova_faiths_pd)
tukey_faiths_pd <- TukeyHSD(anova_faiths_pd, ordered="TRUE")
tukey_faiths_pd
#load libraries
library(phyloseq)
library(DESeq2)
library(tidyverse)
library(RColorBrewer)
theme_set(theme_bw())
setwd("/Volumes/GoogleDrive/Shared drives/Research/active_projects/mat_bacteria/Leucopaxillus_mat/analyses/R analyses")
setwd("/Volumes/GoogleDrive/Shared drives/Research/active_projects/mat_bacteria/Leucopaxillus_mat/analyses/R analyses/16S")
#Color Brewer Pallette
#RColorBrewer::display.brewer.all()
#Manual color scales
PhylaColors <- c("Acidobacteriota" = "#1c9e77", "Actinobacteriota" = "#756fb4", "Bacteroidota" = "#f45c85",
"Chloroflexi" = "#436fb6", "Cyanobacteria" = "seagreen", "Desulfobacterota" = "gold1",
"Firmicutes" = "#d671aa", "Gemmatimonadota" = "#ed4131", "Myxococcota" = "#c2e871",
"Patescibacteria" = "deepskyblue", "Planctomycetota" = "#7a81ff","Proteobacteria" = "orange", "Verrucomicrobiota" = "#66a621")
#Import a phyloseq object (biom should have taxonomy attached), start with UNRAREFIED otu table
leucopax_bact <- import_biom("table-final-with-taxonomy.biom")#, treefilename="tree-leucopax-bact.nwk", refseqfilename="seqs-leucopax-bact.fasta")
#Rename columns
colnames(tax_table(leucopax_bact)) <- c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")
#Read in metadata; standard QIIME2 metadata table can be used here
metadata <- read.csv("metadata-leucopax-bact.csv")
#Create another row for "SampleID"; create a dataframe for the metadata
row.names(metadata) <- metadata$X.SampleID
metadata$SampleID <- metadata$X.SampleID
sample_data(leucopax_bact) <- metadata
sample_names(leucopax_bact) <- metadata
View(metadata)
sample_data(leucopax_bact) <- metadata
library(phyloseq)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq")
library(phyloseq)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq", force=TRUE)
